# Stripe決済付き 基本的なECサイト

これは、Node.js, Express, Stripe Checkout を使用して構築された、シンプルなECサイトのサンプルアプリケーションです。

## 概要

このアプリケーションは、いくつかの商品をリスト表示し、ユーザーが「購入する」ボタンをクリックするとStripeが提供する決済ページにリダイレクトして支払いを行うことができる、基本的なEC機能のデモンストレーションです。

## 主な機能

-   サーバーから動的に商品リストを読み込んで表示
-   Stripe Checkout と連携した決済機能
-   決済成功時・キャンセル時の結果表示ページ

## 技術スタック

-   **バックエンド**: Node.js, Express
-   **決済処理**: Stripe API
-   **フロントエンド**: HTML, CSS, JavaScript (ES6)
-   **その他**: `dotenv` (環境変数管理)

## セットアップと実行方法

### 1. 前提条件

-   [Node.js](https://nodejs.org/) (v14以降を推奨)
-   [Stripe](https://stripe.com/) アカウント

### 2. インストール

まず、このリポジトリをクローンします。

```bash
git clone https://github.com/your-username/basic-ec-with-stripe.git
cd basic-ec-with-stripe
```

次に、必要なnpmパッケージをインストールします。

```bash
npm install
```

### 3. 環境設定

StripeのAPIキーを設定する必要があります。プロジェクトのルートディレクトリに `.env` という名前のファイルを作成し、以下のように記述してください。

```
STRIPE_SECRET_KEY=sk_test_YOUR_SECRET_KEY
```

`sk_test_YOUR_SECRET_KEY` の部分を、ご自身のStripeテスト環境のシークレットキーに置き換えてください。キーは[Stripeダッシュボード](https://dashboard.stripe.com/test/apikeys)で確認できます。

### 4. アプリケーションの起動

以下のコマンドでサーバーを起動します。

```bash
npm start
```

コンソールに `Server is running on port 3000` と表示されれば成功です。

ブラウザで `http://localhost:3000` にアクセスしてください。

## アプリケーションの仕組み

1.  **商品表示**: ユーザーがトップページにアクセスすると、フロントエンドのJavaScriptがバックエンドの `/api/products` エンドポイントを呼び出し、商品情報を取得して画面に表示します。
2.  **決済開始**: ユーザーが「購入する」ボタンをクリックすると、フロントエンドは選択された商品のIDを `/create-checkout-session` エンドポイントにPOSTリクエストで送信します。
3.  **Checkoutセッション作成**: バックエンドサーバーはStripeのAPIを呼び出し、商品の価格やリダイレクト先URLを含む決済セッションを作成します。
4.  **リダイレクト**: バックエンドは作成されたセッションのURLをフロントエンドに返し、フロントエンドはユーザーをそのURL（Stripeの決済ページ）にリダイレクトします。
5.  **決済完了**: ユーザーが決済を完了すると、Stripeは `success_url` に指定されたページ (`/success.html`) にリダイレクトします。キャンセルした場合は `cancel_url` (`/cancel.html`) にリダイレクトされます。

## Next Steps

次回の開発では、以下の機能改善を段階的に行います。

### 1. 商品データのデータベース管理 (SQLite)

**目的:** 現在ソースコード内に直接記述されている商品データをデータベース管理に移行し、拡張性とメンテナンス性を向上させます。

**手順:**
1.  **SQLiteパッケージのインストール:**
    ```bash
    npm install sqlite3
    ```
2.  **データベース設定ファイルの作成:**
    `database.js` を作成し、データベースの接続、テーブル作成、初期データの投入を行う処理を記述します。
3.  **サーバーロジックの修正:**
    `server.js` を修正し、商品データをSQLiteデータベースから取得するように変更します。

### 2. カート機能の実装

**目的:** 複数の商品をカートに追加し、まとめて決済できる機能を実装して、ECサイトとしての利便性を向上させます。

**手順:**
1.  **フロントエンドの改修:**
    -   「購入する」ボタンを「カートに入れる」ボタンに変更します。
    -   ブラウザの `localStorage` を利用して、カートの状態（商品IDと数量）を管理するロジックを追加します。
    -   カート内の商品を確認・編集できる `cart.html` を新規作成します。
2.  **バックエンドの改修:**
    -   `/create-checkout-session` APIを、複数の商品IDと数量のリストを受け取れるように修正します。
    -   受け取った情報をもとにデータベースから正確な商品情報を参照し、複数のアイテムを含むStripe Checkoutセッションを作成するように変更します。
